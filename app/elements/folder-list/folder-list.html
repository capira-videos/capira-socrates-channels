<dom-module id="folder-list">
  <style>
    :host {
      display: block;
      padding-top: 18px !important;
    }

    [list] {
      @apply(--layout-vertical);
    }

    [list-header] {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      height: 64px;
    }

    [list-title] {
      @apply(--paper-font-headline);
    }

    [item] {
      @apply(--layout-horizontal);
    }

    [item-title] {
      @apply(--paper-font-subhead);
      margin-top: 5px;
      max-width: 500px;
    }

    a {
      text-decoration: none;
      color: black;
    }

    img {
      border: none;
    }

    .crop {
      float: left;
      margin: .5em 10px .5em 0;
      overflow: hidden;
      /* this is important */
      border: 0px solid #ccc;
    }
    /* input values to crop the image */

    .crop img {
      margin: -11px -0px -18px 0px
    }

    [selected] {
      background-color: red;
    }
  </style>
  <template>
    <div list>
      <div list-header>
        <span list-title>
          <span>{{listTitle}}</span>s</span>
        <div class="flex"></div>
        <paper-icon-button icon="add" on-click="removeFolder" hidden$="{{!isAuthor}}"></paper-icon-button>
      </div>
      <div>
        <div hidden$="{{list.0}}" class="paper-font-caption">
          Empty. There are no
          <span>
            <span>{{listTitle}}</span>s</span>
          in this Folder yet. Press + to create one.
        </div>

        <template is="dom-repeat" items="{{list}}" id="listElement">
          <div item on-click="toggleSelection" selected$="[[item.selected]]">
            <a href="{{folderUrl(item)}}">
              <span class="crop">
                <img src="{{thumbnail(item)}}" />
              </span>
            </a>
            <span item-title>{{item.title}}</span>
            <div class="flex"></div>
            <div hidden$="{{!isAuthor}}">
              <paper-icon-button icon="delete" on-click="removeItem"></paper-icon-button>
              <paper-icon-button icon="editor:mode-edit" on-click="_rename"></paper-icon-button>
              <paper-icon-button icon="social:public" on-click="promptDelete"></paper-icon-button>
            </div>
          </div>
        </template>

        <array-selector id="selector" items="{{list}}" selected="{{selected}}" multi toggle></array-selector>


        <!--
        <div> Selected Items: </div>
        <template is="dom-repeat" items="{{selected}}">
          <div>Title:
            <span>{{item.title}}</span>
          </div>
        </template> -->

        <rename-dialog id="rename" on-renamed="_onRenamed"></rename-dialog>

        <paper-toast id="removed" duration="7000">
          <a role="button" tabindex="0" style="color: #eeff41;margin: 10px" onclick="console.log('UNDO')">Undo</a>
        </paper-toast>

  </template>
</dom-module>


<script>
  (function() {
    Polymer({
      is: 'folder-list',
      properties: {
        list: Array,
        value: function() {
          return [];
        }
      },

      removeItem: function(event) {
        var item = event.model.item;
        this.deleteIndex = this.list.indexOf(item);
        this.splice('list', this.deleteIndex, 1);
        var toast = this.$.removed;
        toast.text = 'Removed one ' + this.listTitle + '.';
        toast.show();
      },

      thumbnail: function(item) {
        return 'http://img.youtube.com/vi/' + (item.thumbnail ? item.thumbnail : item.videoId) + '/default.jpg';
      },

      unitRef: function(unit) {
        return 'https://capira.de/player/#/' + unit.id;
      },

      folderUrl: function(item) {
        return item.id;
      },


      _rename: function(e) {
        var item = this.$.listElement.itemForElement(e.target);
        var dialog = this.$.rename;
        dialog.open(item);
      },

      _onRenamed: function(e){
          var item=e.detail;
          var i=this.list.indexOf(item);
          this.set('list.'+i+'.title', item.title);
      },


      toggleSelection: function(e) {
        var item = this.$.listElement.itemForElement(e.target);
        item.selected = !item.selected;
        this.$.selector.select(item);
      },

      /*
            ready: function() {
              this.list = [{
                title: "Title 1",
                thumbnail: "---",
                id : 10,
              }, {
                title: "Title 2",
                thumbnail: "---",
                id : 10,
              }, {
                title: "Title 3",
                thumbnail: "---",
                id : 10,
              }, {
                title: "Title 4",
                thumbnail: "---",
                id : 10,
              }, ];
              this.listTitle="Dummy List";


            }
      */

    });
  })();
</script>
